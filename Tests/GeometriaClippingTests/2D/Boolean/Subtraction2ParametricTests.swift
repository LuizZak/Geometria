import Geometria
import TestCommons
import XCTest

@testable import GeometriaClipping

class Subtraction2ParametricTests: XCTestCase {
    let accuracy: Double = 1e-12

    func testSubtraction_vennDiagram() {
        let lhs = Circle2Parametric.makeTestCircle(center: .init(x: -90, y: 0), radius: 200)
        let rhs = Circle2Parametric.makeTestCircle(center: .init(x:  90, y: 0), radius: 200)
        let sut = Subtraction2Parametric(lhs, rhs, tolerance: accuracy)

        TestFixture.beginFixture(lineScale: 1.0) { fixture in
            fixture.add(lhs, category: "input 1")
            fixture.add(rhs, category: "input 2")

            fixture.assertions(on: sut)
                .assertAllSimplexes(
                    accuracy: accuracy,
                    [[GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: -90.0, y: 0.0), radius: 200.0, startAngle: Angle<Double>(radians: 1.1040309877476002), sweepAngle: Angle<Double>(radians: 0.4667653390472963)), startPeriod: 0.0, endPeriod: 0.07428801097334167)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: -90.0, y: 0.0), radius: 200.0, startAngle: Angle<Double>(radians: 1.5707963267948966), sweepAngle: Angle<Double>(radians: 1.5707963267948966)), startPeriod: 0.07428801097334167, endPeriod: 0.3242880109733417)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: -90.0, y: 0.0), radius: 200.0, startAngle: Angle<Double>(radians: 3.141592653589793), sweepAngle: Angle<Double>(radians: 1.5707963267948966)), startPeriod: 0.3242880109733417, endPeriod: 0.5742880109733417)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: -90.0, y: 0.0), radius: 200.0, startAngle: Angle<Double>(radians: 4.71238898038469), sweepAngle: Angle<Double>(radians: 0.46676533904729645)), startPeriod: 0.5742880109733417, endPeriod: 0.6485760219466834)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 90.0, y: 0.0), radius: 200.0, startAngle: Angle<Double>(radians: 4.245623641337393), sweepAngle: Angle<Double>(radians: -1.1040309877476002)), startPeriod: 0.6485760219466834, endPeriod: 0.8242880109733417)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 90.0, y: 0.0), radius: 200.0, startAngle: Angle<Double>(radians: 3.141592653589793), sweepAngle: Angle<Double>(radians: -1.1040309877476002)), startPeriod: 0.8242880109733417, endPeriod: 1.0))]]
                )
        }
    }

    func testSubtraction_lhsContainsRhs() {
        let lhs = Circle2Parametric.makeTestCircle(radius: 100.0)
        let rhs = Circle2Parametric.makeTestCircle(radius: 80.0)
        let sut = Subtraction2Parametric(lhs, rhs)

        TestFixture.beginFixture { fixture in
            fixture.assertions(on: sut)
                .assertAllSimplexes(
                    accuracy: accuracy,
                    [[GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 100.0, startAngle: Angle<Double>(radians: 0.0), sweepAngle: Angle<Double>(radians: 1.5707963267948966)), startPeriod: 0.0, endPeriod: 0.25)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 100.0, startAngle: Angle<Double>(radians: 1.5707963267948966), sweepAngle: Angle<Double>(radians: 1.5707963267948966)), startPeriod: 0.25, endPeriod: 0.5)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 100.0, startAngle: Angle<Double>(radians: 3.141592653589793), sweepAngle: Angle<Double>(radians: 1.5707963267948966)), startPeriod: 0.5, endPeriod: 0.75)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 100.0, startAngle: Angle<Double>(radians: 4.71238898038469), sweepAngle: Angle<Double>(radians: 1.5707963267948966)), startPeriod: 0.75, endPeriod: 1.0))], [GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 80.0, startAngle: Angle<Double>(radians: 6.283185307179586), sweepAngle: Angle<Double>(radians: -1.5707963267948966)), startPeriod: 0.0, endPeriod: 0.25)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 80.0, startAngle: Angle<Double>(radians: 4.71238898038469), sweepAngle: Angle<Double>(radians: -1.5707963267948966)), startPeriod: 0.25, endPeriod: 0.5)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 80.0, startAngle: Angle<Double>(radians: 3.141592653589793), sweepAngle: Angle<Double>(radians: -1.5707963267948966)), startPeriod: 0.5, endPeriod: 0.7499999999999999)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 80.0, startAngle: Angle<Double>(radians: 1.5707963267948966), sweepAngle: Angle<Double>(radians: -1.5707963267948966)), startPeriod: 0.7499999999999999, endPeriod: 1.0))]]
                )
        }
    }

    func testSubtraction_rhsContainsLhs() {
        let lhs = Circle2Parametric.makeTestCircle(radius: 80.0)
        let rhs = Circle2Parametric.makeTestCircle(radius: 100.0)
        let sut = Subtraction2Parametric(lhs, rhs)

        TestFixture.beginFixture { fixture in
            fixture.assertions(on: sut)
                .assertAllSimplexes([])
        }
    }

    func testSubtraction_noIntersectionOrContainment() {
        let lhs = Circle2Parametric.makeTestCircle(center: .init(x: -100, y: 0), radius: 50.0)
        let rhs = Circle2Parametric.makeTestCircle(center: .init(x: 100, y: 0), radius: 50.0)
        let sut = Subtraction2Parametric(lhs, rhs)

        TestFixture.beginFixture { fixture in
            fixture.assertions(on: sut)
                .assertAllSimplexes(accuracy: accuracy, [lhs.allSimplexes()])
        }
    }

    func testSubtraction_lines_lines() {
        let lhs = LinePolygon2Parametric.makeStar()
        let rhs = LinePolygon2Parametric.makeHexagon(radius: 80.0)
        let sut = Subtraction2Parametric(lhs, rhs)

        TestFixture.beginFixture(renderScale: 2.0) { fixture in
            fixture.assertions(on: sut)
                .assertAllSimplexes(
                    accuracy: accuracy,
                    [[GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 100.0, y: 0.0), end: Vector2<Double>(x: 74.97851895895208, y: 8.697460292338842)), startPeriod: 0.0, endPeriod: 0.36254932092322967)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 74.97851895895208, y: 8.697460292338842), end: Vector2<Double>(x: 80.0, y: 0.0)), startPeriod: 0.36254932092322967, endPeriod: 0.5)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 80.0, y: 0.0), end: Vector2<Double>(x: 74.97851895895208, y: -8.697460292338846)), startPeriod: 0.5, endPeriod: 0.6374506790767704)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 74.97851895895208, y: -8.697460292338846), end: Vector2<Double>(x: 100.0, y: 0.0)), startPeriod: 0.6374506790767704, endPeriod: 1.0))], [GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 31.42794501299971, y: 69.28203230275507), end: Vector2<Double>(x: 30.901699437494745, y: 95.10565162951535)), startPeriod: 0.0, endPeriod: 0.3297058196130494)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 30.901699437494745, y: 95.10565162951535), end: Vector2<Double>(x: 11.323626827162714, y: 69.28203230275508)), startPeriod: 0.3297058196130494, endPeriod: 0.7433692504284607)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 11.323626827162714, y: 69.28203230275508), end: Vector2<Double>(x: 31.42794501299971, y: 69.28203230275507)), startPeriod: 0.7433692504284607, endPeriod: 1.0))], [GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -51.244447041333736, y: 49.80607872414753), end: Vector2<Double>(x: -80.90169943749473, y: 58.77852522924732)), startPeriod: 0.0, endPeriod: 0.3621674918480285)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -80.90169943749473, y: 58.77852522924732), end: Vector2<Double>(x: -61.86160744855665, y: 31.41661746672879)), startPeriod: 0.3621674918480285, endPeriod: 0.751801451909878)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -61.86160744855665, y: 31.41661746672879), end: Vector2<Double>(x: -51.244447041333736, y: 49.80607872414753)), startPeriod: 0.751801451909878, endPeriod: 1.0))], [GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -61.86160744855664, y: -31.416617466728745), end: Vector2<Double>(x: -80.90169943749476, y: -58.7785252292473)), startPeriod: 0.0, endPeriod: 0.3896339600618497)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -80.90169943749476, y: -58.7785252292473), end: Vector2<Double>(x: -51.24444704133376, y: -49.80607872414752)), startPeriod: 0.3896339600618497, endPeriod: 0.751801451909878)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -51.24444704133376, y: -49.80607872414752), end: Vector2<Double>(x: -61.86160744855664, y: -31.416617466728745)), startPeriod: 0.751801451909878, endPeriod: 1.0))], [GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 11.323626827162698, y: -69.28203230275508), end: Vector2<Double>(x: 30.901699437494724, y: -95.10565162951536)), startPeriod: 0.0, endPeriod: 0.4136634308154115)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 30.901699437494724, y: -95.10565162951536), end: Vector2<Double>(x: 31.427945012999693, y: -69.28203230275513)), startPeriod: 0.4136634308154115, endPeriod: 0.7433692504284606)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 31.427945012999693, y: -69.28203230275513), end: Vector2<Double>(x: 11.323626827162698, y: -69.28203230275508)), startPeriod: 0.7433692504284606, endPeriod: 1.0))]]
                )
        }
    }

    func testSubtraction_lines_arcs() {
        let lhs = LinePolygon2Parametric.makeHexagon()
        let rhs = Circle2Parametric.makeTestCircle(radius: 95)

        let sut = Subtraction2Parametric(lhs, rhs)

        TestFixture.beginFixture(renderScale: 2.0) { fixture in
            fixture.assertions(on: sut)
                .assertAllSimplexes(
                    accuracy: accuracy,
                    [[GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 100.0, y: 0.0), end: Vector2<Double>(x: 94.52562418976665, y: 9.481897043050221)), startPeriod: 0.0, endPeriod: 0.2677419514601039)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 95.0, startAngle: Angle<Double>(radians: 0.09997590556877567), sweepAngle: Angle<Double>(radians: -0.09997590556877572)), startPeriod: 0.2677419514601039, endPeriod: 0.5000000000000006)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 95.0, startAngle: Angle<Double>(radians: 6.283185307179586), sweepAngle: Angle<Double>(radians: -0.0999759055687752)), startPeriod: 0.5000000000000006, endPeriod: 0.7322580485398962)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 94.52562418976665, y: -9.481897043050214), end: Vector2<Double>(x: 100.0, y: 0.0)), startPeriod: 0.7322580485398962, endPeriod: 1.0))], [GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 55.47437581023338, y: 77.12064333539362), end: Vector2<Double>(x: 50.000000000000014, y: 86.60254037844386)), startPeriod: 0.0, endPeriod: 0.2677419514601039)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 50.000000000000014, y: 86.60254037844386), end: Vector2<Double>(x: 39.051248379533256, y: 86.60254037844386)), startPeriod: 0.2677419514601039, endPeriod: 0.5354839029202082)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 95.0, startAngle: Angle<Double>(radians: 1.147173456765373), sweepAngle: Angle<Double>(radians: -0.19995181113755114)), startPeriod: 0.5354839029202082, endPeriod: 1.0))], [GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -49.99999999999998, y: 86.60254037844388), end: Vector2<Double>(x: -55.47437581023333, y: 77.12064333539367)), startPeriod: 0.0, endPeriod: 0.26774195146010316)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 95.0, startAngle: Angle<Double>(radians: 2.1943710079619714), sweepAngle: Angle<Double>(radians: -0.19995181113755145)), startPeriod: 0.26774195146010316, endPeriod: 0.7322580485398958)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -39.05124837953323, y: 86.60254037844388), end:Vector2<Double>(x: -49.99999999999998, y: 86.60254037844388)), startPeriod: 0.7322580485398958, endPeriod: 1.0))], [GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -94.52562418976665, y: 9.481897043050228), end: Vector2<Double>(x: -100.0, y: 1.2246467991473532e-14)), startPeriod: 0.0, endPeriod: 0.2677419514601035)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -100.0, y: 1.2246467991473532e-14), end: Vector2<Double>(x: -94.52562418976665, y: -9.481897043050205)), startPeriod: 0.2677419514601035, endPeriod: 0.535483902920207)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 95.0, startAngle: Angle<Double>(radians: 3.241568559158569), sweepAngle: Angle<Double>(radians: -0.19995181113755145)), startPeriod: 0.535483902920207, endPeriod: 1.0))], [GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -55.4743758102334, y: -77.12064333539361), end: Vector2<Double>(x: -50.00000000000004, y: -86.60254037844383)), startPeriod: 0.0, endPeriod: 0.26774195146010366)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -50.00000000000004, y: -86.60254037844383), end: Vector2<Double>(x: -39.051248379533334, y: -86.60254037844383)), startPeriod: 0.26774195146010366, endPeriod: 0.535483902920207)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 95.0, startAngle: Angle<Double>(radians: 4.288766110355166), sweepAngle: Angle<Double>(radians: -0.19995181113755148)), startPeriod: 0.535483902920207, endPeriod: 1.0))], [GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 39.05124837953331, y: -86.60254037844386), end: Vector2<Double>(x: 50.000000000000014, y: -86.60254037844386)), startPeriod: 0.0, endPeriod: 0.267741951460104)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 50.000000000000014, y: -86.60254037844386), end: Vector2<Double>(x: 55.47437581023337, y: -77.12064333539365)), startPeriod: 0.267741951460104, endPeriod: 0.5354839029202081)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 95.0, startAngle: Angle<Double>(radians: 5.335963661551764), sweepAngle: Angle<Double>(radians: -0.1999518111375504)), startPeriod: 0.5354839029202081, endPeriod: 1.0))]]
                )
        }
    }

    func testSubtraction_concaveShape() {
        let lhs = LinePolygon2Parametric.makeCShape()
        let rhs = LinePolygon2Parametric.makeRectangle(width: 10, height: 120)
        let sut = Subtraction2Parametric(lhs, rhs)

        TestFixture.beginFixture(renderScale: 2) { fixture in
            fixture.assertions(on: sut)
                .assertAllSimplexes(
                    accuracy: accuracy,
                    [[GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -50.0, y: -50.0), end: Vector2<Double>(x: -4.999999999999999, y: -50.0)), startPeriod: 0.0, endPeriod: 0.1323529411764706)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -4.999999999999999, y: -50.0), end: Vector2<Double>(x: -5.000000000000002, y: -30.0)), startPeriod: 0.1323529411764706, endPeriod: 0.19117647058823528)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -5.000000000000002, y: -30.0), end: Vector2<Double>(x: -30.0, y: -30.0)), startPeriod: 0.19117647058823528, endPeriod: 0.2647058823529412)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -30.0, y: -30.0), end: Vector2<Double>(x: -30.0, y: 30.0)), startPeriod: 0.2647058823529412, endPeriod: 0.4411764705882353)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -30.0, y: 30.0), end: Vector2<Double>(x: -5.000000000000022, y: 30.0)), startPeriod: 0.4411764705882353, endPeriod: 0.5147058823529411)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -5.000000000000022, y: 30.0), end: Vector2<Double>(x: -4.999999999999975, y: 50.0)), startPeriod: 0.5147058823529411, endPeriod: 0.5735294117647058)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -4.999999999999975, y: 50.0), end: Vector2<Double>(x: -50.0, y: 50.0)), startPeriod: 0.5735294117647058, endPeriod: 0.7058823529411765)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: -50.0, y: 50.0), end: Vector2<Double>(x: -50.0, y: -50.0)), startPeriod: 0.7058823529411765, endPeriod: 1.0))], [GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 5.000000000000005, y: -50.0), end: Vector2<Double>(x: 50.0, y: -50.0)), startPeriod: 0.0, endPeriod: 0.38043942381701557)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 50.0, y: -50.0), end: Vector2<Double>(x: 30.0, y: -30.0)), startPeriod: 0.38043942381701557, endPeriod: 0.6195605761829842)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 30.0, y: -30.0), end: Vector2<Double>(x: 4.999999999999982, y: -30.0)), startPeriod: 0.6195605761829842, endPeriod: 0.830915811636882)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 4.999999999999982, y: -30.0), end: Vector2<Double>(x: 5.000000000000005, y: -50.0)), startPeriod: 0.830915811636882, endPeriod: 1.0))], [GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 4.999999999999993, y: 30.0), end: Vector2<Double>(x: 30.0, y: 30.0)), startPeriod: 0.0, endPeriod: 0.21135523545389762)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 30.0, y: 30.0), end: Vector2<Double>(x: 50.0, y: 50.0)), startPeriod: 0.21135523545389762, endPeriod: 0.4504763878198662)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 50.0, y: 50.0), end: Vector2<Double>(x: 4.999999999999977, y: 50.0)), startPeriod: 0.4504763878198662, endPeriod: 0.830915811636882)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 4.999999999999977, y: 50.0), end: Vector2<Double>(x: 4.999999999999993, y: 30.0)), startPeriod: 0.830915811636882, endPeriod: 1.0))]]
                )
        }
    }

    func testSubtraction_rhsOccludesLhsHole() {
        let radius: Double = 50.0
        let circles = [
            Circle2Parametric.makeTestCircle(center: .init(x: 0, y: 55), radius: radius),
            Circle2Parametric.makeTestCircle(center: .init(x: -47, y: -29), radius: radius),
            Circle2Parametric.makeTestCircle(center: .init(x: 48, y: -27), radius: radius),
        ]
        let lhs = union(circles)
        let rhs = Circle2Parametric.makeTestCircle(center: .init(x: 0, y: 0), radius: radius)
        let sut: Subtraction2Parametric = Subtraction2Parametric(lhs, rhs)

        TestFixture.beginFixture(lineScale: 5.0, renderScale: 2.5) { fixture in
            fixture.assertions(on: sut)
                .assertAllSimplexes(
                    accuracy: accuracy,
                    [[GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 55.0), radius: 50.0, startAngle: Angle<Double>(radians: 0.0), sweepAngle: Angle<Double>(radians: 1.5707963267948966)), startPeriod: 0.0, endPeriod: 0.25)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 55.0), radius: 50.0, startAngle: Angle<Double>(radians: 1.5707963267948966), sweepAngle: Angle<Double>(radians: 1.5707963267948966)), startPeriod: 0.25, endPeriod: 0.5)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 55.0), radius: 50.0, startAngle: Angle<Double>(radians: 3.141592653589793), sweepAngle: Angle<Double>(radians: 0.5823642378687436)), startPeriod: 0.5, endPeriod: 0.5926861471367548)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 50.0, startAngle: Angle<Double>(radians: 2.5592284157210496), sweepAngle: Angle<Double>(radians: -0.9884320889261533)), startPeriod: 0.5926861471367548, endPeriod: 0.75)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 50.0, startAngle: Angle<Double>(radians: 1.5707963267948966), sweepAngle: Angle<Double>(radians: -0.9884320889261533)), startPeriod: 0.75, endPeriod: 0.9073138528632452)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 55.0), radius: 50.0, startAngle: Angle<Double>(radians: 5.700821069310844), sweepAngle: Angle<Double>(radians: 0.5823642378687433)), startPeriod: 0.9073138528632452, endPeriod: 1.0))], [GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: -47.0, y: -29.0), radius: 50.0, startAngle: Angle<Double>(radians: 1.5385551813406735), sweepAngle: Angle<Double>(radians: 0.03224114545422309)), startPeriod: 0.0, endPeriod: 0.005131337669984397)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: -47.0, y: -29.0), radius: 50.0, startAngle: Angle<Double>(radians: 1.5707963267948966), sweepAngle: Angle<Double>(radians: 1.5707963267948966)), startPeriod: 0.005131337669984397, endPeriod: 0.25513133766998447)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: -47.0, y: -29.0), radius: 50.0, startAngle: Angle<Double>(radians: 3.141592653589793), sweepAngle: Angle<Double>(radians: 1.5707963267948966)), startPeriod: 0.25513133766998447, endPeriod: 0.5051313376699845)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: -47.0, y: -29.0), radius: 50.0, startAngle: Angle<Double>(radians: 4.71238898038469), sweepAngle: Angle<Double>(radians: 1.1379235886393009)), startPeriod: 0.5051313376699845, endPeriod: 0.6862375016627977)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 50.0, startAngle: Angle<Double>(radians: 4.680147834930466), sweepAngle: Angle<Double>(radians: -1.5385551813406726)), startPeriod: 0.6862375016627977, endPeriod: 0.9311061639928133)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 50.0, startAngle: Angle<Double>(radians: 3.141592653589793), sweepAngle: Angle<Double>(radians: -0.43287273815559535)), startPeriod: 0.9311061639928133, endPeriod: 1.0))], [GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 48.0, y: -27.0), radius: 50.0, startAngle: Angle<Double>(radians: 3.616764793985068), sweepAngle: Angle<Double>(radians: 1.095624186399622)), startPeriod: 0.0, endPeriod: 0.1743740050365359)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 48.0, y: -27.0), radius: 50.0, startAngle: Angle<Double>(radians: 4.71238898038469), sweepAngle: Angle<Double>(radians: 1.5707963267948966)), startPeriod: 0.1743740050365359, endPeriod: 0.4243740050365359)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 48.0, y: -27.0), radius: 50.0, startAngle: Angle<Double>(radians: 0.0), sweepAngle: Angle<Double>(radians: 1.5707963267948966)), startPeriod: 0.4243740050365359, endPeriod: 0.6743740050365359)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 48.0, y: -27.0), radius: 50.0, startAngle: Angle<Double>(radians: 1.5707963267948966), sweepAngle: Angle<Double>(radians: 0.07084526577814718)), startPeriod: 0.6743740050365359, endPeriod: 0.6856493792797871)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 50.0, startAngle: Angle<Double>(radians: 0.4751721403952751), sweepAngle: Angle<Double>(radians: -0.4751721403952751)), startPeriod: 0.6856493792797871, endPeriod: 0.7612753742432512)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 0.0, y: 0.0), radius: 50.0, startAngle: Angle<Double>(radians: 6.283185307179586), sweepAngle: Angle<Double>(radians: -1.4999510610167501)), startPeriod: 0.7612753742432512, endPeriod: 1.0))]]
                )
        }
    }

    func testSubtraction_testCase1() {
        // Shape is not appropriately considering intersections between lines and
        // arcs across some angles
        let lhs = LinePolygon2Parametric<Vector2D>(
            linePolygon2: .init(
                vertices: AABB2D(
                    left: 20,
                    top: 200,
                    right: 800,
                    bottom: 280
                ).corners
            ),
            startPeriod: 0,
            endPeriod: 1
        )
        let rhs = Circle2Parametric.makeTestCircle(
            center: .init(x: 384, y: 259),
            radius: 50
        )
        let sut: Subtraction2Parametric = Subtraction2Parametric(lhs, rhs, tolerance: 1e-14)

        TestFixture.beginFixture(lineScale: 1.0, renderScale: 0.5) { fixture in
            fixture.assertions(on: sut)
                .assertAllSimplexes(
                    accuracy: accuracy,
                    [[GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 20.0, y: 200.0), end: Vector2<Double>(x: 800.0, y: 200.0)), startPeriod: 0.0, endPeriod: 0.4263059743848189)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 800.0, y: 200.0), end: Vector2<Double>(x: 800.0, y: 280.0)), startPeriod: 0.4263059743848189, endPeriod: 0.4700296640653131)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 800.0, y: 280.0), end: Vector2<Double>(x: 429.37620521815376, y: 280.0)), startPeriod: 0.4700296640653131, endPeriod: 0.672592661455921)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 384.0, y: 259.0), radius: 50.0, startAngle: Angle<Double>(radians: 0.433445320069886), sweepAngle: Angle<Double>(radians: -0.43344532006988606)), startPeriod: 0.672592661455921, endPeriod: 0.6844375543735448)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 384.0, y: 259.0), radius: 50.0, startAngle: Angle<Double>(radians: 6.283185307179586), sweepAngle: Angle<Double>(radians: -1.5707963267948966)), startPeriod: 0.6844375543735448, endPeriod: 0.7273631863385701)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 384.0, y: 259.0), radius: 50.0, startAngle: Angle<Double>(radians: 4.71238898038469), sweepAngle: Angle<Double>(radians: -1.5707963267948966)), startPeriod: 0.7273631863385701, endPeriod: 0.7702888183035953)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.circleArc2(GeometriaClipping.CircleArc2Simplex<Geometria.Vector2<Swift.Double>>(circleArc: CircleArc2<Vector2<Double>>(center: Vector2<Double>(x: 384.0, y: 259.0), radius: 50.0, startAngle: Angle<Double>(radians: 3.141592653589793), sweepAngle: Angle<Double>(radians: -0.43344532006988606)), startPeriod: 0.7702888183035953, endPeriod: 0.7821337112212191)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 338.6237947818463, y: 280.0), end: Vector2<Double>(x: 20.0, y: 280.0)), startPeriod: 0.7821337112212191, endPeriod: 0.9562763103195058)), GeometriaClipping.Parametric2GeometrySimplex<Geometria.Vector2<Swift.Double>>.lineSegment2(GeometriaClipping.LineSegment2Simplex<Geometria.Vector2<Swift.Double>>(lineSegment: LineSegment<Vector2<Double>>(start: Vector2<Double>(x: 20.0, y: 280.0), end: Vector2<Double>(x: 20.0, y: 200.0)), startPeriod: 0.9562763103195058, endPeriod: 1.0))]]
                )
        }
    }

    #if GEOMETRIA_PERFORMANCE_TESTS

    func testPerformance_overlapping_circles() {
        let inputs = (0...10).map { offset in
            return Circle2Parametric.makeTestCircle(center: .init(x: Double(offset), y: 0.0), radius: 10.0)
        }

        measure {
            _ = subtraction(inputs[0], Array(inputs[1...]))
        }
    }

    #endif // #if GEOMETRIA_PERFORMANCE_TESTS
}
